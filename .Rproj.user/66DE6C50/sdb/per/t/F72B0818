{
    "contents" : "---\ntitle: \"Motor Trend \nSummary of Regression Models and Exploratory Data Analyses\"\nauthor: \"Marcelo Gomes Marques\"\ndate: \"Saturday, June 21, 2014\"\noutput:\n  pdf_document:\n    highlight: zenburn\n    toc: no  \n  html_document:\n    theme: cerulean\n    toc: no\n---\n\n## Executive Summary\nWith a single linear regressing model between MPG on an automatic/manual transmission we can observe a significant negative effect of automatic transmission on MPG, it **decrease MPG in -7.24** if compared with the manual ones (the reference).  So, we can conclude that **the type of transmission offer a clear separation to predict MPG, but it can predict only for the two means values**. With models analysis we can identify a better model **lm(mpg ~ automatic + hp + wt +I(cyl==6) )**, wath is confirmed by anova function evaluation.  This model presents a good predictions of MPG, with minus residuals, where's we can see a **decrease MPG in -2.266 if the transmission is automatic** and **attend** our choose of **10% to likelihood ration test**.\n## Getting and Cleanning Data\nWe start by loading the **datasets** library and **mtcars** dataset and heading mtcars's help to kwno more about its variables. \n```{r getting, echo=FALSE, eval=TRUE, results='hide'}\nlibrary(datasets)\ndata(mtcars)\nstr(mtcars)\nsummary(mtcars)\n```\nWith this initial understand we proced with:  \n1. Coerce of **am** to a logical variable, where 0 is TRUE and 1 is FALSE, and rename to **automatic**.  \n2. Coerce of **vs** to a logical variable, where 1 is TRUE and 0 is FALSE.  \n3. Coerce the **cyl**, **gear** and **carb** to factor.  \n```{r Clenning, echo=FALSE, eval=TRUE}\n# With the summary and str analysis, we can see that a few data preparation is need to tidy the dataset, only need coerce some variables to class factor and logic as need.\n\nmtcars$am <- mtcars$am == 0\nnames(mtcars)[9] <- \"automatic\"\nmtcars$vs <- mtcars$vs == 1\nmtcars$cyl <- factor(mtcars$cyl)\nmtcars$gear <- factor(mtcars$gear)\nmtcars$carb <- factor(mtcars$carb)\n```  \n## Exploratory Data Analyses\n```{r attaching, echo=FALSE, eval=TRUE}\n## First, the mtcars is attached to the R search path. This means that the mtcars dataset is searched by R when evaluating a variable, so columns in the dataset can be accessed by simply giving their names.\n\nattach(mtcars)\n```  \nSince our main focus of interest is in understanding the effects of the type of transmission in the MPG, will begin in the exploitation of boxplot between these two variables (see in Appendix), we can see clearly that cars with **automatic transmission has worse MPG performance**, where the first three quartile and good part of the fourth are below of the MPG average of the cars with manual transmission.  It's per si answer our questions 1 and 2, but let's proceed with linear regression to improve our analysis.  \nThis situation should result in a **significantly negative effect of automatic transmission on MPG** in a linear regression model. Let's make a simple model between MPG on an automatic/manual transmission to check it.  \n```{r fit1, echo=FALSE, eval=TRUE, results='markdow'}\nfit1 <- lm( mpg ~ automatic, data=mtcars )\nsm <- summary(fit1)\nprint(sm$coefficients)\n```  \nAs we expect, there is a significant negative effect of automatic transmission on MPG, it **decrease MPG in -7.24 if the transmission is automatic** compared with the manual ones, but  with a large residual (see figures including at Appendix).  \n  \n```{r Uniqfit1, echo=FALSE, eval=TRUE, results='hide'}\nUni <- unique(predict(fit1)) # Distinct MPG predicts values\n```  \nIn others words, **the type of transmission offer a clear separation to predict MPG, but it can predict only for the two means values** (`r Uni[1]` for manual and `r Uni[2]` for automatic), since the automatic variable is a boolean variable, it's does not offer a good distribution to allowing MPG prediction with good numbers of distinct values, which results in a large residual values.  \nThis first model should need other variables to reduce the residuals and improve the accuracy of MPG prediction of more than two values, but it establish a good reference to start.  \nAs we can see from pairs plot (see Appendix), qsec, hp, drat, disp and wt appears has a good linear correlation with MPG and presents interesting differences in this relations if you consider the separation of transmission type.  \nFor a closely look this distributions and their linear regressions see the figures at Appedix.  With these analysis, we expect a good model with start with automatic and include hp and wt or disp, since the last two appears similars. The drat and qseq maybe change the signal of our others coefficients, and tend to suffer with their outliers.  \nWe can observe other interesting relation with MPG through cyl and its results based in the separation promoted by transmission type. Since this a factor variable, you can look closely the boxplot with this variables in highlight at the Appendix.  \n## Modeling and Evaluation\nAll models analysis sought the best model to predict MPG, but maintain our reference on the effect of the transmission type. We made 8 models and using its p-values as an instrument for identify the coefficients more significances and the others that it's better if we discard them. We use the gain in reduced of residual standard error to initial evaluation if the model is better than others.  \nOk, before we proceed, it's interesting if we try a model with all variables, just to confirm the worst effects of not selecting variables properly.\n```{r RMall, echo=FALSE, eval=TRUE, results='hide'}\nfitAll <- lm(mpg ~ ., data=mtcars)\nsm <- summary(fitAll); \nbetterPv <- sm$coefficients[,4][order((sm$coefficients[,4]))][1:4] # First four minors P-values\n```  \nThe results is intersting becouse we can observed that:  \n**_Pros:_**  \n- Manual transmission is in the reference too  \n- Automatic transmission maintain the signal, but with minor impact was as expected, since others terms presents better distributions of predicts MPG and it's presents relations with others terms  \n- The Residuals reduced nearly too half  \n**_Cons:_**  \n- The P-value of all Coefficients incresily drasticaly and are greatter tham likelihood ratio test of 10%. The 4th better p-values in order are **`r betterPv`** from **`r names(betterPv)`** respectively.  \n\nSo, according to this criterion, we would fail to reject, which suggests that some terms may not be necessary and we can obtem better results with less predictors in our model.\n\nLet's try other models, but only with the variables select by our exploratory analysis, and **check if the P-Values of its coefficients are greatter tham 10%** (hypotesis test based in P-Value by the expression _reject <- sm$coefficients[,4][sm$coefficients[,4]>0.1]_ where _sm_ is the _summay's result of fit model_) to reject these respectives terms.\n```{r RMopt1, echo=FALSE, eval=TRUE, results='hide'}\nfitOpt1 <- lm( mpg ~ automatic + cyl + disp + hp + wt, data=mtcars )\nsm <- summary(fitOpt1);\nreject <- sm$coefficients[,4][sm$coefficients[,4]>0.1] \nprint(reject)\n```  \nWith the lm model **(mpg ~ automatic + cyl + disp + hp + wt)** we can see that automatic transmission, 8 cyls and disp with p-values (`r reject`), it's better if we reject them.  \n\n```{r RMopt2, echo=FALSE, eval=TRUE, results='hide'}\nfitOpt2 <- lm( mpg ~ automatic + hp , data=mtcars )\nsm <- summary(fitOpt2); \nreject <- sm$coefficients[,4][sm$coefficients[,4]>0.1] \nprint(reject)\n``` \nThe model **lm(mpg ~ automatic + hp)** prove is better and we don't need reject any term. Let's see if we can get a better model.   \n```{r RMopt3, echo=FALSE, eval=TRUE, results='hide'}\nfitOpt3 <- lm( mpg ~ automatic + hp +cyl , data=mtcars )\nsm <- summary(fitOpt3); \nreject <- sm$coefficients[,4][sm$coefficients[,4]>0.1] \nprint(reject)\n``` \nThe third model, **lm( mpg ~ automatic + hp +cyl)**, reduce the Residual standard error to 2.7, but get worse P-Values and we need reject the 8 cylinders coefficient (`r names(reject)` p-value iqual a **`r reject`**). Our 4th model, **lm( mpg ~ automatic + hp +I(cyl==6))** ,that consider only the influence of 6 cylinders is better, include the P-values of each coefficients (see anova evaluation)  \n```{r RMopt4, echo=FALSE, eval=TRUE, results='hide'}\nfitOpt4 <- lm( mpg ~ automatic + hp +I(cyl==6) , data=mtcars )\nsm <- summary(fitOpt4); sm$coefficients[,4][sm$coefficients[,4]>0.1] \n```  \nWith the 5th model, **lm( mpg ~ automatic + hp + wt +I(cyl==6))**, we check the influency of wt.\n```{r RMopt5, echo=FALSE, eval=TRUE, results='hold'}\nfitOpt5 <- lm( mpg ~ automatic + hp + wt +I(cyl==6) , data=mtcars )\nsm<- summary(fitOpt5)\nprint(sm$coefficients)\n```  \nAgain we reduces the **Residual standard error**, now to **`r sm$sigma`** on `r max(sm$df)` degrees of freedom, __our best__ if compared with each models, and all P-Value are under 10%.  \n```{r RMopt6, echo=FALSE, eval=TRUE, results='hide'}\nfitOpt6 <- lm( mpg ~ automatic + hp + disp +I(cyl==6)  , data=mtcars )\nsm <- summary(fitOpt6); \nsm$coefficients[,4][sm$coefficients[,4]>0.1] \n```  \nIn the 6th model, where is change the wt for disp in the previous model, we observed that is very similar to the previous models result and don't nedd reject any term.    \n```{r RMopt7, echo=FALSE, eval=TRUE, results='hide'}\nfitOpt7 <- lm( mpg ~ automatic + hp + wt +  qsec + I(cyl==6)  , data=mtcars )\nsm <- summary(fitOpt7); \nreject <- sm$coefficients[,4][sm$coefficients[,4]>0.1] \n``` \nAt last, we evaluate the influence of qsec, and observe that the model has worse response compared to others (p-values of **`r names(reject)`** are **`r reject`** respectively).  \n\n## Selecting the Best Model:\nThe anova results confirms our suspect that the 5th model is the best.\n```{r anova, echo=FALSE, eval=TRUE, results='hold'}\nanova(fitOpt1, fitOpt2, fitOpt3, fitOpt4, fitOpt5,  fitOpt6, fitOpt7, fitAll)\n```  \n\n## Conclusion:\nThis best model results in:  \n- Confirmed ours main assumptions of exploratory analysis  \n- Confirmed that manual transmission is better for MPG,\n- Established a good coefficient to measure of change in MPG according to the transmission type\n- Established a good predictions of MPG, with strog predictors validated by our  hypotesis test based in pvalue.  \n- Maintan our focus on the analysis of transmission type influency, where's we can see coefficients -2.266. it represents a decrease MPG in -2.266 if the transmission is automatic and attend our choose of 10% to likelihood ration test, and    \n- presents minus residuals.\n\n## Appendix:  \n### Exporatory Analysis:  \n```{r Explor1, echo=FALSE, eval=TRUE, results='hold'}\npar(mfrow=c(3,3),mar=c(4,4,1,1), cex=0.3, cex.main=1.5)\nboxplot(mpg ~ automatic, data=mtcars, names=c('Manual', 'Automatic'), main=\"MPG by Transmission Type\")\nboxplot( mpg ~ cyl, data = mtcars, main=\"MPG by Number of Cylinders\")\nboxplot( mpg ~ cyl*automatic, data = mtcars, main=\"MPG by Number of Cylinders and Transmission Type\")\n\nplot(wt, mpg, col=automatic + 3, main=\"wt x MPG by Transmission Type\")\nabline(lm(mpg~wt,data=mtcars[automatic==F,]),  col=4)\nabline(lm(mpg~wt,data=mtcars[automatic==T,]),  col=3)\n\nplot(disp, mpg, col=automatic + 3, main=\"disp x MPG by Transmission Type\")\nabline(lm(mpg~disp,data=mtcars[automatic==F,]),  col=4)\nabline(lm(mpg~disp,data=mtcars[automatic==T,]),  col=3)\n\nplot(hp, mpg,  col=automatic + 3, main=\"hp x MPG by Transmission Type\")\nabline(lm(mpg~hp,data=mtcars[automatic==F,]),  col=4)\nabline(lm(mpg~hp,data=mtcars[automatic==T,]),  col=3)\n\nplot(qsec, mpg, col=automatic + 3, main=\"qsec x MPG by Transmission Type\")\nabline(lm(mpg~qsec,data=mtcars[automatic==FALSE,]),  col=4)\nabline(lm(mpg~qsec,data=mtcars[automatic==TRUE,]),  col=3)\n\nplot(drat, mpg,  col=automatic + 3, main=\"drat x MPG by Transmission Type\")\nabline(lm(mpg~drat,data=mtcars[automatic==F,]),  col=4)\nabline(lm(mpg~drat,data=mtcars[automatic==T,]),  col=3)\n\n\npairs(mtcars, col=automatic+3, pin=c(1,1))\n```  \n  \n### Models Analysis: \n```{r fit1eva, echo=FALSE, eval=TRUE, results='hold'}\npar(mfrow=c(2,3))\nhist(fit1$residuals, main=\"First Linear Model - Ref. Model:\")\nplot(fit1)\n\npar(mfrow=c(2,3))\nhist(fitOpt5$residuals, main=\"Best Model Plots:\")\nplot(fitOpt5)\n\n```  \n\n",
    "created" : 1403570351987.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "734783193",
    "id" : "F72B0818",
    "lastKnownWriteTime" : 1403461467,
    "path" : "~/RM_PA_RESUME/MotorTrend.Rmd",
    "project_path" : null,
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_markdown"
}